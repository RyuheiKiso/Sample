# 通信仕様

---

## 機能

- **テーブル管理機能**

## 構成

| 区分             | 技術   |
|------------------|--------|
| フロントエンド   | React  |
| バックエンド     | Rust   |

## 方式

- [ ] REST API
- [x] gRPC
- [ ] WebSocket  
  ※上記から選択

---

## サービス/メソッド

### Table管理
| メソッド名         | 概要             |
|--------------------|------------------|
| ListTables         | テーブル一覧取得 |
| CreateTable        | テーブル作成     |
| UpdateTable        | テーブル更新     |
| DeleteTable        | テーブル削除     |

### Column管理
| メソッド名         | 概要                 |
|--------------------|----------------------|
| ListColumns        | 列一覧取得           |
| CreateColumn       | 列追加               |
| UpdateColumn       | 列編集               |
| DeleteColumn       | 列削除               |

### RowData管理
| メソッド名         | 概要                 |
|--------------------|----------------------|
| ListRows           | 行データ一覧取得     |
| CreateRow          | 行データ追加         |
| UpdateRow          | 行データ編集         |
| DeleteRow          | 行データ削除         |

---

## proto定義例

```proto
syntax = "proto3";

package table;

service TableService {
  rpc ListTables (ListTablesRequest) returns (ListTablesResponse);
  rpc CreateTable (CreateTableRequest) returns (CreateTableResponse);
  rpc UpdateTable (UpdateTableRequest) returns (UpdateTableResponse);
  rpc DeleteTable (DeleteTableRequest) returns (DeleteTableResponse);
}

service ColumnService {
  rpc ListColumns (ListColumnsRequest) returns (ListColumnsResponse);
  rpc CreateColumn (CreateColumnRequest) returns (CreateColumnResponse);
  rpc UpdateColumn (UpdateColumnRequest) returns (UpdateColumnResponse);
  rpc DeleteColumn (DeleteColumnRequest) returns (DeleteColumnResponse);
}

service RowDataService {
  rpc ListRows (ListRowsRequest) returns (ListRowsResponse);
  rpc CreateRow (CreateRowRequest) returns (CreateRowResponse);
  rpc UpdateRow (UpdateRowRequest) returns (UpdateRowResponse);
  rpc DeleteRow (DeleteRowRequest) returns (DeleteRowResponse);
}

message Table {
  int64 id = 1;
  string physical_name = 2;
  string logical_name = 3;
  string description = 4;
  string created_at = 5;
  string updated_at = 6;
}

message Column {
  int64 id = 1;
  int64 table_id = 2;
  string physical_name = 3;
  string logical_name = 4;
  string data_type = 5;
  string constraints = 6;
  string description = 7;
  string created_at = 8;
  string updated_at = 9;
}

message RowData {
  int64 id = 1;
  int64 table_id = 2;
  map<string, string> values = 3; // 列物理名→値
  string created_at = 4;
  string updated_at = 5;
}

// Table
message ListTablesRequest {}
message ListTablesResponse { repeated Table tables = 1; }
message CreateTableRequest { string physical_name = 1; string logical_name = 2; string description = 3; }
message CreateTableResponse { Table table = 1; }
message UpdateTableRequest { int64 id = 1; string physical_name = 2; string logical_name = 3; string description = 4; }
message UpdateTableResponse { Table table = 1; }
message DeleteTableRequest { int64 id = 1; }
message DeleteTableResponse {}

// Column
message ListColumnsRequest { int64 table_id = 1; }
message ListColumnsResponse { repeated Column columns = 1; }
message CreateColumnRequest { int64 table_id = 1; string physical_name = 2; string logical_name = 3; string data_type = 4; string constraints = 5; string description = 6; }
message CreateColumnResponse { Column column = 1; }
message UpdateColumnRequest { int64 id = 1; string physical_name = 2; string logical_name = 3; string data_type = 4; string constraints = 5; string description = 6; }
message UpdateColumnResponse { Column column = 1; }
message DeleteColumnRequest { int64 id = 1; }
message DeleteColumnResponse {}

// RowData
message ListRowsRequest { int64 table_id = 1; }
message ListRowsResponse { repeated RowData rows = 1; }
message CreateRowRequest { int64 table_id = 1; map<string, string> values = 2; }
message CreateRowResponse { RowData row = 1; }
message UpdateRowRequest { int64 id = 1; map<string, string> values = 2; }
message UpdateRowResponse { RowData row = 1; }
message DeleteRowRequest { int64 id = 1; }
message DeleteRowResponse {}
```

---

## リクエスト・レスポンス例

### ListTables
- リクエスト: 空
- レスポンス: tables: Table配列

### CreateTable
- リクエスト: physical_name, logical_name, description
- レスポンス: table: 作成されたTable

### ListColumns
- リクエスト: table_id
- レスポンス: columns: Column配列

### CreateColumn
- リクエスト: table_id, physical_name, logical_name, data_type, constraints, description
- レスポンス: column: 作成されたColumn

### ListRows
- リクエスト: table_id
- レスポンス: rows: RowData配列

### CreateRow
- リクエスト: table_id, values（列物理名→値のマップ）
- レスポンス: row: 作成されたRowData

---

## エラー例

- INVALID_ARGUMENT: 必須パラメータ不足
- NOT_FOUND: 指定IDのテーブルが存在しない
- INTERNAL: サーバ内部エラー

---

## 備考