# ディレクトリ構成(Rust)

---

## 概要

バーティカルスライスを採用  

---

## ディレクトリ構成

```
backend/
├── Cargo.toml
├── proto/                # gRPC用protoファイル（全体管理用）
│   └── auth.proto
├── data/                 # データベースファイル配置用ディレクトリ
│   └── app.db            # SQLiteデータベースファイル
├── src/
│   ├── main.rs
│   ├── common/           # 共通関数・ユーティリティ
│   │   ├── mod.rs
│   │   ├── util.rs
│   │   └── db.rs         # データベース接続（クエリベース）
│   ├── features/
│   │   ├── user/
│   │   │   ├── mod.rs
│   │   │   ├── handler.rs
│   │   │   ├── service.rs
│   │   │   └── repository.rs
│   │   ├── login/        # ログイン機能
│   │   │   ├── mod.rs
│   │   │   ├── handler.rs
│   │   │   ├── service.rs
│   │   │   ├── repository.rs
│   │   │   ├── client.rs         # gRPCクライアント実装例
│   │   │   └── proto/            # gRPC生成コード配置例（module化する場合）
│   │   │       ├── auth.rs       # tonic-build等で生成されたRustコード
│   │   │       └── mod.rs
│   │   └── product/
│   │       ├── mod.rs
│   │       ├── handler.rs
│   │       ├── service.rs
│   │       └── repository.rs
└── tests/
    └── integration_test.rs
```

### バーティカルスライスの特徴

- `features/` 配下に「機能単位」でディレクトリを作成し、各機能ごとにAPI・サービス・リポジトリ等をまとめます。
- 各スライスが独立しており、変更の影響範囲を限定できます。
- **例: ログイン機能**  
  `features/login/` ディレクトリに、ログイン処理に関するAPIハンドラ・サービス・リポジトリ、gRPCクライアント実装（`client.rs`）、gRPC生成コード（`proto/`）を実装します。

### 共通関数・ユーティリティ

- `common/` ディレクトリに、複数の機能で利用する共通処理やユーティリティ関数を配置します。
- 例: `db.rs` にクエリベースのデータベース接続機能を実装し、各機能から利用できるようにします。

### gRPC protoファイル

- `proto/` ディレクトリにgRPCサービス定義用の`.proto`ファイルを配置します。
- 例: `proto/auth.proto` に認証サービスのproto定義を記述します。
- 各機能で利用するgRPC生成コードは`features/<機能>/proto/`等に配置し、モジュールとして管理することも可能です。

---

## srcとtestsの違い

- `src/`  
  - アプリケーション本体のソースコードを配置します。
  - 機能ごと（バーティカルスライス）にディレクトリを分け、ビジネスロジックやAPI、リポジトリなどを実装します。
  - 本番環境で利用されるコードのみを含みます。

- `tests/`  
  - 統合テストやエンドツーエンドテストなど、アプリケーション全体や複数モジュールをまたぐテストコードを配置します。
  - `src/`の公開API（`pub`）を通じて動作を検証します。
  - テスト専用のディレクトリであり、本番バイナリには含まれません。

---