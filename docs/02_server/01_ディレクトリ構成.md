# ディレクトリ構成(Go)

---

## 概要

バーティカルスライスを採用

---

## ディレクトリ構成

```
backend/
├── go.mod
├── proto/                # gRPC用protoファイル（全体管理用）
│   └── auth.proto
├── data/                 # データベースファイル配置用ディレクトリ
│   └── app.db            # SQLiteデータベースファイル
├── internal/
│   ├── common/           # 共通関数・ユーティリティ
│   │   ├── util.go
│   │   └── db.go         # データベース接続（クエリベース）
│   ├── user/
│   │   ├── handler.go
│   │   ├── service.go
│   │   └── repository.go
│   ├── login/            # ログイン機能
│   │   ├── handler.go
│   │   ├── service.go
│   │   ├── repository.go
│   │   ├── client.go         # gRPCクライアント実装例
│   │   └── proto/            # gRPC生成コード配置例（module化する場合）
│   │       └── auth.pb.go    # protoc等で生成されたGoコード
│   └── product/
│       ├── handler.go
│       ├── service.go
│       └── repository.go
└── test/
    └── integration_test.go
```

### バーティカルスライスの特徴

- `internal/` 配下に「機能単位」でディレクトリを作成し、各機能ごとにAPI・サービス・リポジトリ等をまとめます。
- 各スライスが独立しており、変更の影響範囲を限定できます。
- **例: ログイン機能**  
  `internal/login/` ディレクトリに、ログイン処理に関するAPIハンドラ・サービス・リポジトリ、gRPCクライアント実装（`client.go`）、gRPC生成コード（`proto/`）を実装します。

### 共通関数・ユーティリティ

- `common/` ディレクトリに、複数の機能で利用する共通処理やユーティリティ関数を配置します。
- 例: `db.go` にクエリベースのデータベース接続機能を実装し、各機能から利用できるようにします。

### gRPC protoファイル

- `proto/` ディレクトリにgRPCサービス定義用の`.proto`ファイルを配置します。
- 例: `proto/auth.proto` に認証サービスのproto定義を記述します。
- 各機能で利用するgRPC生成コードは`internal/<機能>/proto/`等に配置し、モジュールとして管理することも可能です。

---

## internalとtestの違い

- `internal/`  
  - アプリケーション本体のソースコードを配置します。
  - 機能ごと（バーティカルスライス）にディレクトリを分け、ビジネスロジックやAPI、リポジトリなどを実装します。
  - 本番環境で利用されるコードのみを含みます。

- `test/`  
  - 統合テストやエンドツーエンドテストなど、アプリケーション全体や複数モジュールをまたぐテストコードを配置します。
  - `internal/`の公開APIを通じて動作を検証します。
  - テスト専用のディレクトリであり、本番バイナリには含まれません。

---